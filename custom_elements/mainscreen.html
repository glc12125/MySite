<polymer-element name="main-screen" attributes="responsiveWidth mainscreenLabel">

<template>
	<link rel="stylesheet" href="css/mainscreen.css">
	<div id="card" on-transitionend="{{cardTransitionDone}}" hidden?="{{!mainscreenLabel}}">

        <div class="element-label" hidden?="{{narrow}}">{{mainscreenLabel}}</div>

        <div id="frameContainer">
          <iframe id="frame" on-load="{{frameLoaded}}"></iframe>
        </div>
        
    </div>
</template>

<script>
	Polymer('main-screen', {

		responsiveWidth: '860px',

		mainscreenLabel: '',

		ready: function() {
	      this.boundResizeFrame = this.resizeFrame.bind(this);
	      window.addEventListener('resize', this.updateFrameHeight.bind(this));
	    },
	    

		animateCard: function() {
	      this.$.card.classList.remove('move-up');
	      this.$.card.style.display = 'none';
	      this.async(function() {
	        this.$.card.style.display = 'block';
	        this.moveCard(this.$.mainHeaderPanel.offsetHeight);
	        this.async(function() {
	          this.$.card.classList.add('move-up');
	          this.moveCard(null);
	        }, null, 300);
	      });
	    },
	    
	    moveCard: function(y) {
	      var s = this.$.card.style;
	      s.webkitTransform = s.transform = 
	          y ? 'translate3d(0, ' + y + 'px,0)' : '';
	    },
	    
	    cardTransitionDone: function() {
	      if (this.$.card.classList.contains('move-up')) {
	        this.$.card.classList.remove('move-up');
	        this.updateFrameHeight();
	      }
	    },

	    frameLoaded: function() {
	      if (!this.mainscreenLabel) {
	        return;
	      }
	      this.$.frame.contentWindow.addEventListener('polymer-ready', function() {
	        setTimeout(this.updateFrameHeight.bind(this), 100);
	        this.$.frame.contentWindow.addEventListener('core-resize',
	          this.boundResizeFrame, false);
	      }.bind(this));
	    },

	    resizeFrame: function() {
	      this.job('resizeFrame', function() {
	        this.updateFrameHeight();
	      });
	    },
	    
	    updateFrameHeight: function() {
	      var frame = this.$.frame;
	      var doc = frame.contentDocument;
	      if (doc) {
	        var docElt = doc.documentElement;
	        // TODO(ffu); expose scroll info from header-panel
	        var pos = this.$.mainHeaderPanel.$.mainContainer.scrollTop;
	        frame.style.height = 'auto';
	        frame.style.height = docElt.scrollHeight + 'px';
	        if (doc.body) {
	          var s = doc.body.style;
	          s.overflow = 'hidden';
	          // to avoid the 'blinking bug'
	          // https://code.google.com/p/chromium/issues/detail?id=332024
	          s.webkitTransform = s.transform = 'translateZ(0)';
	        }
	        this.$.mainHeaderPanel.$.mainContainer.scrollTop = pos;
	      }
	    }
	});
</script>
</polymer-element>